# Build jobs configuration

# Each top-level element is a 'job', with three sections:
# - fetch: a string with a path relative to the project root
# - build: a dictionary with each build 'step' and its parameters
#   - See the functions in dev/jobs.py for available steps and parameters
#   - Parameters not specified imply default values
# - deploy: with the navbar text (if applicable) and target path relative to site root (_dist/)

# Sitemap:
sitemap:
  source: static/sitemap.xml
  target: static/sitemap.xml
  steps:
    build_sitemap: {
      exclude: "(404|LICENSE.*|authors)\\.html",
      external: [library\rfcd, tools\phyopt, tools\mtsdesc],
      priority: {
        /index.html: 1.0,
        /cv\index.html: 0.5,
        /blog\index.html: 0.5,
        /library\rfcd\index.html: 0.8,
        /tools\phyopt\index.html: 0.8,
        /tools\mtsdesc\index.html: 0.8,
      },
      changefreq: {}
    }
# changefreq options: always, hourly, daily, weekly, monthly, yearly and never

# Index page:
index:
  source: src/index
  target: _dist
  steps:
    build_navbar: {label: Home}
    inject_template: {}
    assets_compile: {subsource: module, subtarget: index, type: "css", include: "\\.scss"}
    assets_move: {subsource: module, subtarget: index, exclude: "\\.scss"}


# CV:
cv:
  source: src/cv
  target: _dist/cv
  steps:
    build_navbar: {label: CV}
    inject_template: {}
    assets_compile: {subsource: module, type: "css", include: "\\.scss"}
    assets_move: {subsource: module, exclude: "\\.scss"}


# Blog:
blog:
  source: src/blog
  target: ""
  steps:
    build_navbar: {subtarget: _dist/blog, label: Blog}
    inject_template: {subsource: module, subtarget: src/blog/module}
    quarto_blog: {subtarget: _dist/blog}
    #assets_compile: {subsource: module, subtarget: _dist/blog, type: "css", include: "\\.scss"}
    #assets_move: {subsource: module, subtarget: _dist/blog, exclude: "\\.scss"}


# External projects:
rfcd:
  source: _dist/library/rfcd
  target: _dist/library/rfcd
  steps:
    build_navbar: {label: RFCD, drop_label: Library}
    inject_project: rsbookdown
    assets_remove: {subsource: assets, include: "global\\.(js|css)"}
phyopt:
  source: _dist/tools/phyopt
  target: _dist/tools/phyopt
  steps:
    build_navbar: {label: phyopt, drop_label: Tools}
    inject_project: rspkgdown
    assets_remove: {subsource: assets, include: "global\\.(js|css)"}
mtsdesc:
  source: _dist/tools/mtsdesc
  target: _dist/tools/mtsdesc
  steps:
    build_navbar: {label: mtsdesc}
    inject_project: rspkgdown
    assets_remove: {subsource: assets, include: "global\\.(js|css)"}

# Assets:
static_root:
  source: static
  target: _dist
  steps:
    assets_move: {include: "404\\.html|robots\\.txt|sitemap\\.xml"}
static_assets:
  source: static
  target: _dist/assets/img
  steps:
    assets_move: {include: "img$"}
global:
  source: src/global
  target: _dist/assets
  steps:
    assets_compile: {type: "css", include: "\\.scss"}
    assets_move: {exclude: "\\.scss|components\\.html", flatten: True}
  deploy:
global_site:
  source: _dist/assets
  target: _dist/assets
  steps:
    assets_merge: {
      subtarget: global.css,
      include: [palette.css, global_style.css, global_structure.css]
    }
