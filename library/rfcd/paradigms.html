<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<!-- Meta --><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Ricardo Semião e Castro" name="Author"/>
<link href="/assets/img/icon.png" rel="icon" type="image/png"/>
<link href="/assets/img/icon.png" rel="shortcut icon" type="image/png"/>
<title>7 Paradigmas de Programação | R: Fundamentos e Ciência de Dados</title>
<meta content="este capítulo está em construção. O que segue abaixo é apenas um rascunho.  7.1 Introdução Referência básica: Advanced R (2e) partes “Functional Programming” + documentação do pacote “purrr”,..." name="description"/>
<meta content="bookdown 0.45 with bs4_book()" name="generator"/>
<meta content="7 Paradigmas de Programação | R: Fundamentos e Ciência de Dados" property="og:title"/>
<meta content="book" property="og:type"/>
<meta content="https://ricardo-semiao.github.io/course-rfcd/paradigms.html" property="og:url"/>
<meta content="este capítulo está em construção. O que segue abaixo é apenas um rascunho.  7.1 Introdução Referência básica: Advanced R (2e) partes “Functional Programming” + documentação do pacote “purrr”,..." property="og:description"/>
<meta content="summary" name="twitter:card"/>
<meta content="7 Paradigmas de Programação | R: Fundamentos e Ciência de Dados" name="twitter:title"/>
<meta content="@ricardo_semiao" name="twitter:site"/>
<meta content="este capítulo está em construção. O que segue abaixo é apenas um rascunho.  7.1 Introdução Referência básica: Advanced R (2e) partes “Functional Programming” + documentação do pacote “purrr”,..." name="twitter:description"/>
<!-- JS --><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet"/>
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet"/>
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet"/>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet"/>
<script src="libs/datatables-binding-0.34.0/datatables.js"></script><link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet"/>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet"/>
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet"/>
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet"/>
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet"/>
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><script crossorigin="anonymous" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script crossorigin="anonymous" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js"></script><script crossorigin="anonymous" src="https://kit.fontawesome.com/6ecbd6c532.js"></script><script crossorigin="anonymous" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js"></script><script crossorigin="anonymous" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"></script><!-- CSS --><style type="text/css">
        div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    </style>
<style type="text/css">
        /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
        div.csl-bib-body { }
        div.csl-entry {
            clear: both;
                    margin-bottom: 0em;
                }
        .hanging div.csl-entry {
            margin-left:2em;
            text-indent:-2em;
        }
        div.csl-left-margin {
            min-width:2em;
            float:left;
        }
        div.csl-right-inline {
            margin-left:2em;
            padding-left:1em;
        }
        div.csl-indent {
            margin-left: 2em;
        }
    </style>
<!-- Custom Assets --><link href="/assets/global.css" rel="stylesheet"/>
<link href="./assets/rsbd_module.css" rel="stylesheet"/>
<script async="" data-goatcounter="https://ricardo-semiao.goatcounter.com/count" src="//gc.zgo.at/count.js"></script>
</head>
<body class="rssite-external" data-spy="scroll" data-target="#toc">
<!-- @@site-icons@@ -->
<header id="rssite-header">
<nav aria-label="Main site navigation">
<ul>
<li class="nav-li"><a href="/">Home</a></li>
<li class="nav-li"><a href="/blog">Blog</a></li>
<li class="nav-drop">
<button aria-controls="menu-projects" aria-expanded="false">
<svg><use href="/assets/img/icons.svg#icon-user"></use></svg>Personal
                    </button>
<ul id="menu-personal">
<li class="nav-li"><a href="/cv">CV</a></li>
<li class="nav-li"><a href="/gallery">Gallery</a></li>
</ul>
</li>
<li class="nav-drop">
<button aria-controls="menu-projects" aria-expanded="false">
<svg><use href="/assets/img/icons.svg#icon-project"></use></svg>Projects
                    </button>
<ul id="menu-projects">
<li class="nav-li"><a href="/library/rfcd">RFCD</a></li>
<li class="nav-li"><a href="/tools/phyopt">phyopt</a></li>
<li class="nav-li"><a href="/tools/mtsdesc">mtsdesc</a></li>
</ul>
</li>
</ul>
</nav>
</header><main class="rssite-rsbookdown" id="rssite-main"><div class="container-fluid" id="rsbookdown-main">
<div class="row">
<header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>
<div class="d-flex align-items-start justify-content-between">
<h1>
<a href="index.html" title="">R: Fundamentos e Ciência de Dados</a>
</h1>
<button aria-controls="main-nav" aria-expanded="true" class="btn btn-outline-primary d-lg-none ml-2 mt-1" data-target="#main-nav" data-toggle="collapse" type="button">
<i class="fas fa-bars"></i>
<span class="sr-only">Show table of contents</span>
</button>
</div>
<div class="collapse-lg" id="main-nav">
<form role="search">
<input aria-label="Search" class="form-control" id="search" placeholder="Buscar" type="search"/>
</form>
<nav aria-label="Table of contents"><h2>Índice</h2>
<ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem Vindo(a)!</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introdução</a></li>
<li class="book-part">Parte I - Fundamentos: R Base</li>
<li><a class="" href="intro1.html">Introdução</a></li>
<li><a class="" href="syntax-vars.html"><span class="header-section-number">2</span> Sintaxe e Variáveis</a></li>
<li><a class="" href="data-attrs.html"><span class="header-section-number">3</span> Tipos de Valores e Atributos</a></li>
<li><a class="" href="subset.html"><span class="header-section-number">4</span> Subsetting</a></li>
<li><a class="" href="control-conds.html"><span class="header-section-number">5</span> Control Flow e Condições</a></li>
<li><a class="" href="funs-envs.html"><span class="header-section-number">6</span> Funções e Ambientes</a></li>
<li><a class="active" href="paradigms.html"><span class="header-section-number">7</span> Paradigmas de Programação</a></li>
<li><a class="" href="others1.html"><span class="header-section-number">8</span> Outros Tópicos</a></li>
<li><a class="" href="recap1.html">Recapitulando</a></li>
<li class="book-part">Parte II - Fundamentos: Tidyverse</li>
<li><a class="" href="intro2.html">Introdução</a></li>
<li><a class="" href="philosophy.html"><span class="header-section-number">9</span> Filosofia, readr, tibble</a></li>
<li><a class="" href="stringr-forcats.html"><span class="header-section-number">10</span> stringr e forcats</a></li>
<li><a class="" href="tidyr-dplyr.html"><span class="header-section-number">11</span> tidyr e dplyr</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">12</span> ggplot2</a></li>
<li><a class="" href="purrr.html"><span class="header-section-number">13</span> purrr</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">14</span> Datas e Séries de Tempo</a></li>
<li><a class="" href="others2.html"><span class="header-section-number">15</span> Outros</a></li>
<li><a class="" href="recap2.html">Recapitulando</a></li>
<li class="book-part">Parte III - Ciência de Dados: Processar</li>
<li><a class="" href="intro3.html">Introdução</a></li>
<li><a class="" href="ds.html"><span class="header-section-number">16</span> Ciência de Dados</a></li>
<li><a class="" href="import-tidy.html"><span class="header-section-number">17</span> Importar e Arrumar</a></li>
<li><a class="" href="manipulate.html"><span class="header-section-number">18</span> Manipular</a></li>
<li><a class="" href="unite.html"><span class="header-section-number">19</span> Unir</a></li>
<li><a class="" href="recap3.html">Recapitulando</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">20</span> Visualizar</a></li>
<li class="book-part">Parte IV - Ciência de Dados: Explorar</li>
<li><a class="" href="intro4.html">Introdução</a></li>
<li><a class="" href="stats-prob.html"><span class="header-section-number">21</span> Probabilidade e Estatística</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">22</span> Regressão</a></li>
<li><a class="" href="ml.html"><span class="header-section-number">23</span> Aprendizado de Máquina</a></li>
<li><a class="" href="others4.html"><span class="header-section-number">24</span> Outras Aplicações</a></li>
<li><a class="" href="recap4.html">Recapitulando</a></li>
<li class="book-part">Apêndice</li>
<li><a class="" href="dict.html">Dicionário de funções</a></li>
<li><a class="" href="refs.html">Referências</a></li>
</ul>
<!--<div class="book-extra">
              <p><a id="book-repo" href="#">Ver código do livro <i class="fab fa-github"></i></a></li></p>
            </div>-->
</nav>
</div>
</header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div class="section level1" id="paradigms" number="7">
<h1>
<span class="header-section-number">7</span> Paradigmas de Programação<a aria-label="anchor" class="anchor" href="#paradigms"><i class="fas fa-link"></i></a>
</h1>
<div class="warn">
<p>este capítulo está em construção. O que segue abaixo é apenas um rascunho.</p>
</div>
<div class="section level2" id="introdução-6" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introdução<a aria-label="anchor" class="anchor" href="#introdu%C3%A7%C3%A3o-6"><i class="fas fa-link"></i></a>
</h2>
<p>Referência básica: Advanced R (2e) partes <a href="https://adv-r.hadley.nz/fp.html">“Functional Programming”</a> + <a href="https://purrr.tidyverse.org/">documentação do pacote “purrr”</a>, <a href="https://adv-r.hadley.nz/oo.html">“Object-Oriented Programming”</a>, <a href="https://adv-r.hadley.nz/metaprogramming.html">“Metaptrogramming”</a> + <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Computing-on-the-language">“R Language Definition” capítulo 6</a> e do <a href="https://rlang.r-lib.org/">pacote rlang</a>.</p>
<p>Na aula de hoje, aprenderemos construtos de mais alto nível. Falaremos do último tijolinho, as expressões. Por fim, faremos uma revisão.</p>
<p>Haverão três aprendizados principais:</p>
<p><strong>(i)</strong> O que é, quais são os construtos, e para que usar programação funcional.</p>
<p><strong>(ii)</strong> O que é, e para que usar programação orientada a objetos.</p>
<p><strong>(iii)</strong> O que são expressões, e como usá-las para metaprogramação.</p>
<p>Para os exemplos:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org">rlang</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" id="pf-fundamentos" number="7.2">
<h2>
<span class="header-section-number">7.2</span> PF: Fundamentos<a aria-label="anchor" class="anchor" href="#pf-fundamentos"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="programação-funcional" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Programação Funcional<a aria-label="anchor" class="anchor" href="#programa%C3%A7%C3%A3o-funcional"><i class="fas fa-link"></i></a>
</h3>
<p>Programação funcional é um termo usado em contextos diferentes, mas no geral, se refere à programas onde as protagonistas são as funções.</p>
<p>Linguagen funcional é um conceito técnico de Ciência da Programação, que normalmente se refere à uma linguagem com funções <em>first-class</em> e <em>pures</em>.</p>
<p>O primeiro termo vocês já conhecem, o segundo quer dizer funções que:</p>
<ul>
<li>O resultado depende apenas dos inputs (<code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code>?)</li>
<li>Funções apenas retornam um resultado, nenhum efeito colateral (<code>&lt;-</code>?).</li>
</ul>
<p>Ainda assim, linguagens que não são estritamente funcionais, podem tomar decisões de desing que privilegiam um <em>estilo de programação</em> funcional. Um estilo que deriva seus principais construtos através de funções.</p>
<p>Quais são os construtos centrados em funções?</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>Object</th>
<th>Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Object</td>
<td>function</td>
<td>function factory</td>
</tr>
<tr class="even">
<td>Function</td>
<td>functional</td>
<td>function operator</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div class="section level2" id="pf-functionals" number="7.3">
<h2>
<span class="header-section-number">7.3</span> PF: Functionals<a aria-label="anchor" class="anchor" href="#pf-functionals"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="functionals" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Functionals<a aria-label="anchor" class="anchor" href="#functionals"><i class="fas fa-link"></i></a>
</h3>
<p>No dia a dia, o construto mais importante serão os functionals. E dentre eles, o <em>map</em>, que vocês já tiveram uma palinha, será o principal.</p>
<p>O R base implementa vários functionals, mas, na minha opinião, o pacote <a href="https://purrr.tidyverse.org/">purrr</a> e suas funções <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> são melhores.</p>
</div>
<div class="section level3" id="map-1" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Map<a aria-label="anchor" class="anchor" href="#map-1"><i class="fas fa-link"></i></a>
</h3>
<p>Um <em>map</em> recebe uma função e um vetor, e a aplica em cada um dos elementos dele, retornando os resultados em um novo vetor.</p>
<p>Como foi visto, são similares à loops:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3" id="map-2" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> Map 2<a aria-label="anchor" class="anchor" href="#map-2"><i class="fas fa-link"></i></a>
</h3>
<p>Pense sobre o padrão abaixo:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">f</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>É um <em>map</em>, aplica dois vetores, termo-a-termo, em uma função.</p>
<p>No purrr, a função que faz isso é <code><a href="https://purrr.tidyverse.org/reference/map2.html">purrr::map2()</a></code>.</p>
</div>
<div class="section level3" id="map2" number="7.3.4">
<h3>
<span class="header-section-number">7.3.4</span> Map^2<a aria-label="anchor" class="anchor" href="#map2"><i class="fas fa-link"></i></a>
</h3>
<p>E se quisermos, para cada elemento de um vetor <code>x</code>, aplicar a função <code>f</code> à esse elemento, e todos os elementos de <code>y</code>?</p>
<p>Isto é, um loop duplo:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">f</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note que isso é diferente de um <code>map2</code>, isso seria um “map” dentro de outro “map”:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">x</span>, \<span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">y</span>, \<span class="op">(</span><span class="va">yi</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">f</span><span class="op">(</span><span class="va">xi</span>, <span class="va">yi</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" id="map-p" number="7.3.5">
<h3>
<span class="header-section-number">7.3.5</span> Map p<a aria-label="anchor" class="anchor" href="#map-p"><i class="fas fa-link"></i></a>
</h3>
<p>Voltando ao map 2? E se em vez de dois vetores, quero combinar termo-a-termo três vetores? Quatro? Um número <span class="math inline">\(p\)</span> de vetores?</p>
<p>Aí temos <code><a href="https://purrr.tidyverse.org/reference/pmap.html">purrr::pmap</a></code>. A lógica é a mesma, passamos <em>vários</em> vetores, e depois uma função.</p>
<p>Temos que <code>map2(x, y, f)</code> é equivalente à <code>pmap(list(x, y), f)</code>. Mas, também podemos fazer <code>pmap(list(x, y, z), f)</code>, etc.</p>
<p>Obs: por uma decisão de <em>design</em>, agrupamos esses vários vetores (de mesmo tamanho) em uma lista.</p>
</div>
<div class="section level3" id="mapp" number="7.3.6">
<h3>
<span class="header-section-number">7.3.6</span> Map^p<a aria-label="anchor" class="anchor" href="#mapp"><i class="fas fa-link"></i></a>
</h3>
<p>E se quisésse-mos fazer um map, dentro de um map, dentro de um map … arbitrárias vezes? A resposta é: não inventa.</p>
<p>Sério, seria estranho ter essa necessidade, e provavelmente era melhor usar um loop while. Mas só de curiosidade, dá pra escrever um <em>map</em> recursivo, que fixa o primeiro vetor e joga o resto pra dentro de um novo map:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span>, <span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">l</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">rmap</span><span class="op">(</span><span class="va">l</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, \<span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">l</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">f</span><span class="op">)</span></span>
<span>  <span class="op">}</span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3" id="atalhos" number="7.3.7">
<h3>
<span class="header-section-number">7.3.7</span> Atalhos<a aria-label="anchor" class="anchor" href="#atalhos"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Index map:</strong> muitas vezes estamos interessados em um caso especial de <code>map2</code>, para qual existe o atalho <code><a href="https://purrr.tidyverse.org/reference/imap.html">purrr::imap()</a></code>:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, \<span class="op">(</span><span class="va">xi</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span><span class="va">...</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html">imap</a></span><span class="op">(</span><span class="va">x</span>, \<span class="op">(</span><span class="va">xi</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span><span class="va">...</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><strong>Selecionando elementos:</strong> outro padrão comum é ter uma lista de listas como <code class="sourceCode r"><span class="fu">list</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>), <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">3</span>, <span class="at">b =</span> <span class="dv">4</span>))</code> e querer selecionar todos os primeiros elementos de cada sub-lista, ou todos os elementos.</p>
<p>Vocês sabem que podem fazer:</p>
<ul>
<li>
<code>map(x, ~ .x[[1]])</code>, ou <code>map(x, ~ .x[["a"]])</code>.</li>
<li>Mas o purrr tem um atalho: <code>map(x, 1)</code>, ou <code>map(x, "a")</code>.</li>
</ul>
<p><strong>Sintaxe lambda:</strong> O purrr permite utilizar fórmulas para definir funções, uma <a href="https://rlang.r-lib.org/reference/as_function.html">sintaxe especial do rlang</a>: <code>\(x, y) x + y</code> é equivalente à <code>~ .x + .y</code>.</p>
<p><strong>Argumentos fixos:</strong> <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> pode receber argumentos extras, via <code>...</code>, passados para a função <em>mapper</em>. Mas, a recomendação é sempre criar uma função anônima:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Piping:</strong> as funções do purr também funcionam muito bem com piping:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" id="escolhendo-o-output" number="7.3.8">
<h3>
<span class="header-section-number">7.3.8</span> Escolhendo o Output<a aria-label="anchor" class="anchor" href="#escolhendo-o-output"><i class="fas fa-link"></i></a>
</h3>
<p>Vimos que <code>map</code> e amigos sempre retornam uma lista, e se eu quiser um vetor simplificado? Podemos coagir na mão: <code class="sourceCode r"><span class="fu">map</span>(mtcars, mean) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</code>.</p>
<p>Mas, também existem as funções <code>map_*()</code> e amigos:</p>
<ul>
<li>
<code class="sourceCode r"><span class="fu">map_dbl</span>(mtcars, mean)</code>.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/modify.html">purrr::modify()</a></code> retorna um vetor do mesmo tipo do input.</li>
</ul>
<p>Lembrando que, para conseguir um vetor simplificado, todos os resultados devem ser do mesmo tipo e ter length 1.</p>
<p>E se eu não me importo com o output, só estou chamando uma função pelos seus efeitos colaterais? Aí existe <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::walk()</a></code> e amigos.</p>
</div>
<div class="section level3" id="e-amigos" number="7.3.9">
<h3>
<span class="header-section-number">7.3.9</span> E Amigos<a aria-label="anchor" class="anchor" href="#e-amigos"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="30%"/>
<col width="13%"/>
<col width="25%"/>
<col width="17%"/>
<col width="14%"/>
</colgroup>
<thead><tr class="header">
<th></th>
<th>List</th>
<th>Atomic</th>
<th>Same type</th>
<th>Nothing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>One argument</td>
<td><code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code></td>
<td>
<code><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl()</a></code>, …</td>
<td><code><a href="https://purrr.tidyverse.org/reference/modify.html">modify()</a></code></td>
<td><code><a href="https://purrr.tidyverse.org/reference/map.html">walk()</a></code></td>
</tr>
<tr class="even">
<td>Two arguments</td>
<td><code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code></td>
<td>
<code><a href="https://purrr.tidyverse.org/reference/map2.html">map2_lgl()</a></code>, …</td>
<td><code><a href="https://purrr.tidyverse.org/reference/modify.html">modify2()</a></code></td>
<td><code><a href="https://purrr.tidyverse.org/reference/map2.html">walk2()</a></code></td>
</tr>
<tr class="odd">
<td>One argument + index</td>
<td><code><a href="https://purrr.tidyverse.org/reference/imap.html">imap()</a></code></td>
<td>
<code><a href="https://purrr.tidyverse.org/reference/imap.html">imap_lgl()</a></code>, …</td>
<td><code><a href="https://purrr.tidyverse.org/reference/modify.html">imodify()</a></code></td>
<td><code><a href="https://purrr.tidyverse.org/reference/imap.html">iwalk()</a></code></td>
</tr>
<tr class="even">
<td>N arguments</td>
<td><code><a href="https://purrr.tidyverse.org/reference/pmap.html">pmap()</a></code></td>
<td>
<code><a href="https://purrr.tidyverse.org/reference/pmap.html">pmap_lgl()</a></code>, …</td>
<td>—</td>
<td><code><a href="https://purrr.tidyverse.org/reference/pmap.html">pwalk()</a></code></td>
</tr>
</tbody>
</table></div>
<p>Alternativas no R base:</p>
<ul>
<li>Considere <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> como substituto de <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>.</li>
<li>Considere <code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> como substituto de <code>map_*()</code> (mais consistente que <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>).</li>
<li>Considere <code><a href="https://rdrr.io/r/base/funprog.html">Map()</a></code> como substituto de <code><a href="https://purrr.tidyverse.org/reference/pmap.html">pmap()</a></code>. Não existe uma versão generalizada de <code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code>, apenas de <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>, a <code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code>.</li>
<li>
<code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> é interessante para operar com matrizes ou linhas de um dataframe.</li>
</ul>
</div>
<div class="section level3" id="quando-usar-um-map" number="7.3.10">
<h3>
<span class="header-section-number">7.3.10</span> Quando Usar um Map?<a aria-label="anchor" class="anchor" href="#quando-usar-um-map"><i class="fas fa-link"></i></a>
</h3>
<p>Lembre-se a escolha entre cada tipo de loop – que inclui maps – é baseada no nível de flexibilidade quista.</p>
<p>O principal ponto de maps é que suas iterações são independentes! Se você quer atualizar uma variável em todas as iterações, deveria estar usando um loop.</p>
</div>
<div class="section level3" id="reduce" number="7.3.11">
<h3>
<span class="header-section-number">7.3.11</span> Reduce<a aria-label="anchor" class="anchor" href="#reduce"><i class="fas fa-link"></i></a>
</h3>
<p>A operação reduce, implementada em <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce()</a></code>, recebe um vetor de tamaho <span class="math inline">\(n\)</span> e retorna um escalar, aplicando uma operação repetidamente:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img height="100%" src="assets/img/reduce1.svg" width="30%"/></div>
<p>Reduce é uma ferramenta útil para genralizar uma função que trabalha com dois inputs (uma função binária) para trabalhar com qualquer número de inputs:</p>
<ul>
<li>
<code class="sourceCode r"><span class="fu">sum</span>(x)</code> é equivalente à <code class="sourceCode r"><span class="fu">reduce</span>(x, <span class="st">`</span><span class="at">+</span><span class="st">`</span>)</code>.</li>
<li>Às vezes, é melhor criar uma nova função.</li>
</ul>
</div>
<div class="section level3" id="reduce-início-customizado" number="7.3.12">
<h3>
<span class="header-section-number">7.3.12</span> Reduce: Início Customizado<a aria-label="anchor" class="anchor" href="#reduce-in%C3%ADcio-customizado"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce()</a></code> aceita um argumento <code>.init</code>, que é o valor inicial da operação. Se não for fornecido, o primeiro elemento de <code>x</code> é usado.</p>
<p>Normalmente, queremos um elemento “identidade” da operação que estamos fazendo – <span class="math inline">\(0\)</span> é a identidade da soma, <span class="math inline">\(1\)</span> é a identidade da multiplicação, etc.</p>
<div class="inline-figure"><img height="100%" src="assets/img/reduce1_init.svg" width="30%"/></div>
</div>
<div class="section level3" id="reduce-2" number="7.3.13">
<h3>
<span class="header-section-number">7.3.13</span> Reduce 2<a aria-label="anchor" class="anchor" href="#reduce-2"><i class="fas fa-link"></i></a>
</h3>
<p>Não quero perder muito tempo com isso, mas também temos a versão “2” de reduce:</p>
<div class="columns">
<div class="column" style="width:48%;">
<div class="inline-figure"><img height="100%" src="assets/img/reduce2.svg" width="80%"/></div>
</div>
<div class="column" style="width:2%;">
</div>
<div class="column" style="width:48%;">
<div class="inline-figure"><img height="100%" src="assets/img/reduce2_init.svg" width="80%"/></div>
</div>
</div>
</div>
<div class="section level3" id="reduce-outros" number="7.3.14">
<h3>
<span class="header-section-number">7.3.14</span> Reduce: Outros<a aria-label="anchor" class="anchor" href="#reduce-outros"><i class="fas fa-link"></i></a>
</h3>
<p>Também poderíamos estar interessados em criar um “reduce p”, “reduce^2”, etc.</p>
<p>Tamém temos <code><a href="https://purrr.tidyverse.org/reference/accumulate.html">purrr::accumulate()</a></code>, que é como <code><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce()</a></code>, mas retorna um vetor do mesmo tamanho de <code>x</code>, com os resultados intermediários.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/accumulate.html">accumulate</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="va">`+`</span><span class="op">)</span> <span class="co">#&gt; 1  3  6 10</span></span></code></pre></div>
</div>
<div class="section level3" id="predicate-functionals" number="7.3.15">
<h3>
<span class="header-section-number">7.3.15</span> Predicate Functionals<a aria-label="anchor" class="anchor" href="#predicate-functionals"><i class="fas fa-link"></i></a>
</h3>
<p>Temos alguns funcionais relacionados à testes lógicos:</p>
<ul>
<li>
<code><a href="https://purrr.tidyverse.org/reference/every.html">some()</a></code>: retorna <code>TRUE</code> se algum elemento de <code>.x</code> satisfaz <code>.p</code>.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/every.html">every()</a></code>: retorna <code>TRUE</code> se todos os elementos de <code>.x</code> satisfazem <code>.p</code>.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/every.html">none()</a></code>: retorna <code>TRUE</code> se nenhum elemento de <code>.x</code> satisfaz <code>.p</code>.</li>
<li>São similares à <code class="sourceCode r"><span class="fu">any</span>(<span class="fu">map_lgl</span>(.x, .p))</code>, etc.</li>
</ul>
<p>Temos também <code><a href="https://purrr.tidyverse.org/reference/detect.html">detect()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/detect.html">detect_index()</a></code>, que retornam o primeiro elemento que satisfaz <code>.p</code> e sua posição, respectivamente.</p>
<p>E <code><a href="https://purrr.tidyverse.org/reference/keep.html">keep()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/keep.html">discard()</a></code>, que mantém ou descartam os elementos que satisfazem <code>.p</code>.</p>
<p><code>map</code> e <code>modify</code> têm variantes que também aceitam funções de predicado, transformando apenas os elementos que passam uma condição, ou que estão em uma localidade específica: <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_if()</a></code> e <code>map_at</code>.</p>
</div>
<div class="section level3" id="outros" number="7.3.16">
<h3>
<span class="header-section-number">7.3.16</span> Outros<a aria-label="anchor" class="anchor" href="#outros"><i class="fas fa-link"></i></a>
</h3>
<p>Vocês talvez não perceberam, mas esta foi a primeira aula sobre o tidyverse! Vocês aprenderam o básico do pacote purrr.</p>
<p>Ele é muito grande, e existem muitas ourtas variações de <code>map</code> e predicates para facilitar sua vida. Foquem que aprender map antes de ir para <a href="https://purrr.tidyverse.org/reference/index.html">o resto</a>.</p>
<p>Por fim, outras funções são functionals e vocês não sabiam:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/integrate.html">integrate()</a></code> encontra a área sob a curva definida por <code>f</code>.</li>
<li>
<code><a href="https://rdrr.io/r/stats/uniroot.html">uniroot()</a></code> encontra onde <code>f</code> atinge zero.</li>
<li>
<code><a href="https://rdrr.io/r/stats/optimize.html">optimise()</a></code> encontra o mínimo/máximo de <code>f</code>.</li>
</ul>
</div>
</div>
<div class="section level2" id="pf-function-factories" number="7.4">
<h2>
<span class="header-section-number">7.4</span> PF: Function Factories<a aria-label="anchor" class="anchor" href="#pf-function-factories"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="function-factories" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> Function Factories<a aria-label="anchor" class="anchor" href="#function-factories"><i class="fas fa-link"></i></a>
</h3>
<p>Uma <em>function factory</em> é uma função que faz funções.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">exp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">^</span> <span class="va">exp</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">square</span> <span class="op">&lt;-</span> <span class="fu">power1</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu">power1</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">square</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="co">#&gt; 9</span></span></code></pre></div>
</div>
<div class="section level3" id="function-factories-envs" number="7.4.2">
<h3>
<span class="header-section-number">7.4.2</span> Function Factories’ Envs<a aria-label="anchor" class="anchor" href="#function-factories-envs"><i class="fas fa-link"></i></a>
</h3>
<p>Porque funciona? Onde <code>square</code> vai procurar <code>exp</code>?</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">square</span> <span class="co">#&gt; function(x) x ^ exp</span></span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">square</span><span class="op">)</span> <span class="co">#&gt; &lt;environment: 0x0000017235c2c3b0&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">cube</span><span class="op">)</span> <span class="co">#&gt; &lt;environment: 0x0000017235150760&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">square</span><span class="op">)</span><span class="op">$</span><span class="va">exp</span> <span class="co">#&gt; 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">cube</span><span class="op">)</span><span class="op">$</span><span class="va">exp</span> <span class="co">#&gt; 3</span></span></code></pre></div>
<p>Cuidado com:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">square</span> <span class="op">&lt;-</span> <span class="fu">power1</span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="fu">square</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="co">#&gt; 8</span></span></code></pre></div>
<p>Porque <code>x</code> é lazily evaluated. Por isso, é bom forcar sua avaliação antes de criar a função, com <code class="sourceCode r"><span class="fu">force</span>(x)</code>:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">exp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span><span class="op">(</span><span class="va">exp</span><span class="op">)</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">^</span> <span class="va">exp</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3" id="function-factories-envs-1" number="7.4.3">
<h3>
<span class="header-section-number">7.4.3</span> Function Factories’ Envs<a aria-label="anchor" class="anchor" href="#function-factories-envs-1"><i class="fas fa-link"></i></a>
</h3>
<p>Adicionalmente, podemos criar funções “manufaturadas” que alterem seu ambiente de encapsulação – que é único.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power1_count</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">exp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span><span class="op">(</span><span class="va">exp</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="st">"i"</span>, <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, envir <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/env_parent.html">env_parent</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co">#ou i &lt;&lt;- i + 1</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>res <span class="op">=</span> <span class="va">x</span> <span class="op">^</span> <span class="va">exp</span>, count <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2" id="pf-function-operators" number="7.5">
<h2>
<span class="header-section-number">7.5</span> PF: Function Operators<a aria-label="anchor" class="anchor" href="#pf-function-operators"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="function-operators" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> Function Operators<a aria-label="anchor" class="anchor" href="#function-operators"><i class="fas fa-link"></i></a>
</h3>
<p>Uma <em>function operator</em> é uma função que recebe uma ou mais funções como input e retorna uma função como output.</p>
<p>Por exemplo, usar <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time()</a></code> para transformar uma função em uma função que também retorna seu tempo de execução.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timeit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>res <span class="op">=</span> <span class="va">res</span>, time <span class="op">=</span> <span class="va">end</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sum_time</span> <span class="op">&lt;-</span> <span class="fu">timeit</span><span class="op">(</span><span class="va">sum</span><span class="op">)</span></span>
<span><span class="fu">sum_time</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!--
timeit <- function(f) {
  f_new <- function(...) {
    start <- Sys.time()
    res <- f(...)
    end <- Sys.time()
    list(res = res, time = end - start)
  }
  if (!is.primitive(f)) {
    #formals(f_new) <- formals(f)
    #environment(f_new) <- environment(f)
  }
  f_new
}
-->
<p>Outros dois exemplos úteis são <code><a href="https://purrr.tidyverse.org/reference/safely.html">purrr::safely()</a></code> e <code><a href="https://memoise.r-lib.org/reference/memoise.html">memoise::memoise()</a></code>.</p>
<ul>
<li>Memoise é uma função que guarda o resultado de uma função, para que não seja recalculado.</li>
<li>Safely é uma função que captura erros, ao invés de parar a execução do programa.</li>
</ul>
<p>Safely está no purr porque é útil para <code>map</code> e amigos:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="st">"erro"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">safely</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ result: int 10</span></span>
<span><span class="co">#&gt;   ..$ error : NULL</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ result: int 26</span></span>
<span><span class="co">#&gt;   ..$ error : NULL</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ result: NULL</span></span>
<span><span class="co">#&gt;   ..$ error :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ message: chr "invalid 'type' (character) of argument"</span></span>
<span><span class="co">#&gt;   .. ..$ call   : language .Primitive("sum")(..., na.rm = na.rm)</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</span></span></code></pre></div>
</div>
</div>
<div class="section level2" id="oop" number="7.6">
<h2>
<span class="header-section-number">7.6</span> OOP<a aria-label="anchor" class="anchor" href="#oop"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="definição-1" number="7.6.1">
<h3>
<span class="header-section-number">7.6.1</span> Definição<a aria-label="anchor" class="anchor" href="#defini%C3%A7%C3%A3o-1"><i class="fas fa-link"></i></a>
</h3>
<p>Da wikipédia:</p>
<blockquote>
<p>Object-oriented programming (OOP) is a programming paradigm based on the concept of objects, which can contain data and code: data in the form of attributes, and code in the form of methods. In OOP, computer programs are designed by making them out of objects that interact with one another.</p>
</blockquote>
<p>Muitas linguagens são multi-paradigma, o próprio R, por exemplo. O que temos, são diferenças de <em>estilo de resolução de problemas</em>: podemos centrar nosso estilo em funções, ou em objetos.</p>
</div>
<div class="section level3" id="sistemas-de-oop-no-r" number="7.6.2">
<h3>
<span class="header-section-number">7.6.2</span> Sistemas de OOP no R<a aria-label="anchor" class="anchor" href="#sistemas-de-oop-no-r"><i class="fas fa-link"></i></a>
</h3>
<p>Vocês já conhecem o principal, S3. Lembrem que ele era diferente do python, era um sistema OOP de <em>generic functions</em>. Mas existem outros:</p>
<ul>
<li>S4, que é o S3 mas de uma maneira mais formal e complicada.</li>
<li>RC, que é um sistema de OOP mais tradicional.</li>
<li>R6, que é o RC mas <a href="https://adv-r.hadley.nz/r6.html#why-r6">melhor</a>.</li>
<li>Entre outros como R.oo e proto.</li>
</ul>
</div>
<div class="section level3" id="sistemas-de-oop-no-r-1" number="7.6.3">
<h3>
<span class="header-section-number">7.6.3</span> Sistemas de OOP no R<a aria-label="anchor" class="anchor" href="#sistemas-de-oop-no-r-1"><i class="fas fa-link"></i></a>
</h3>
<p>S3 é importante de aprender porque é muito utilizado, inclusive no R base. Os outros são mais raros. Do Advanced R:</p>
<blockquote>
<p>S4 is a rigorous system that forces you to think carefully about program design. It’s particularly well-suited for building large systems that evolve over time and will receive contributions from many programmers.</p>
</blockquote>
<blockquote>
<p>R6 provides a standardised way to escape R’s copy-on-modify semantics. This is particularly important if you want to model objects that exist independently of R.</p>
</blockquote>
</div>
<div class="section level3" id="quando-usar-oop" number="7.6.4">
<h3>
<span class="header-section-number">7.6.4</span> Quando Usar OOP<a aria-label="anchor" class="anchor" href="#quando-usar-oop"><i class="fas fa-link"></i></a>
</h3>
<p>O sistema S3 faz parte integral do R, e você utilizará ele para:</p>
<ul>
<li>Criar um método de uma classe não suportada por uma função genérica de seu interesse.</li>
<li>Criar funções genéricas quando criar código a ser compartilhado com outros (pacotes, principalmente).</li>
</ul>
<p>Para além disso, o R não é uma linguagem orientada a objetos, se seu problema demanda isso, pode ser melhor usar outra linguagem. Ainda assim:</p>
<ul>
<li>O sistema R6 é útil para criar objetos que existem independentemente do R.</li>
<li>Muitas aplicações fora da realidade da ciência de dados se dão bem com abordagem de OOP.</li>
</ul>
</div>
</div>
<div class="section level2" id="expressões" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Expressões<a aria-label="anchor" class="anchor" href="#express%C3%B5es"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="definição-2" number="7.7.1">
<h3>
<span class="header-section-number">7.7.1</span> Definição<a aria-label="anchor" class="anchor" href="#defini%C3%A7%C3%A3o-2"><i class="fas fa-link"></i></a>
</h3>
<p>Vocês viram sobre o <em>estilo</em> de resolução de problemas que coloca objetos no centro, funções no centro, e em breve, verão o estilo que coloca <em>expressões</em> no centro.</p>
<p>Mas antes, vamos estudar esse tipo de objeto.</p>
</div>
<div class="section level3" id="tipos-de-expressões" number="7.7.2">
<h3>
<span class="header-section-number">7.7.2</span> Tipos de Expressões<a aria-label="anchor" class="anchor" href="#tipos-de-express%C3%B5es"><i class="fas fa-link"></i></a>
</h3>
<p>Vocês viram que expressões são “código congelado”.</p>
<p>Uma expressão tem <em>tipo</em> <em>expression</em>, mas existem “subtipos” a despeito da sua natureza/objetivo:</p>
<ul>
<li>Call, ou language, se é uma chamada de função.</li>
<li>Symbol, ou name, se é um nome de objeto.</li>
<li>Constant, se é um “dado cru” (<code>1</code>).</li>
<li>Pairlist, se é uma lista de argumentos – algo vestigial.</li>
</ul>
<p>Os mais importantes são Call e Symbol:</p>
<ul>
<li>Um symbol é uma expressão limitada, que segue as regras de nome.</li>
<li>Uma call tem uma estrutura específica, é como uma lista com: o nome da função, e cada argumentos (nomeados ou não). Conseguiremos alterar cada componente.</li>
</ul>
</div>
<div class="section level3" id="tipos-baseados-em-expressões" number="7.7.3">
<h3>
<span class="header-section-number">7.7.3</span> Tipos Baseados em Expressões<a aria-label="anchor" class="anchor" href="#tipos-baseados-em-express%C3%B5es"><i class="fas fa-link"></i></a>
</h3>
<p>Uma expressão pode ser “detalhada”, unida com outros objetos para se tornar alguns dos objetos:</p>
<ul>
<li>Quosure, se unida com um ambiente onde deve ser avaliada.</li>
<li>Closure, se unida com um ambiente e uma lista de argumentos.</li>
<li>Promise, se unida com um ambiente e o comportamento de colapsar após ser avaliada.</li>
<li>Formula, uma call à função <code>~</code> com um ambiente.</li>
</ul>
<p>Obs: quosure e formulas não são tipos de verdade. Quosures são construídos em cima de promises, e formulas em cima de calls.</p>
</div>
<div class="section level3" id="ast" number="7.7.4">
<h3>
<span class="header-section-number">7.7.4</span> AST<a aria-label="anchor" class="anchor" href="#ast"><i class="fas fa-link"></i></a>
</h3>
<p>Por último, vou apresentar como visualizamos expressões – e por consequência, scripts: as abstract syntax trees.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/ast.html">ast</a></span><span class="op">(</span><span class="fu">f1</span><span class="op">(</span><span class="fu">f2</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fu">f3</span><span class="op">(</span><span class="fl">1</span>, <span class="fu">f4</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; █─f1 </span></span>
<span><span class="co">#&gt; ├─█─f2 </span></span>
<span><span class="co">#&gt; │ ├─a </span></span>
<span><span class="co">#&gt; │ └─b </span></span>
<span><span class="co">#&gt; └─█─f3 </span></span>
<span><span class="co">#&gt;   ├─1 </span></span>
<span><span class="co">#&gt;   └─█─f4 </span></span>
<span><span class="co">#&gt;     └─2</span></span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/ast.html">ast</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; █─`+` </span></span>
<span><span class="co">#&gt; ├─1 </span></span>
<span><span class="co">#&gt; └─█─`*` </span></span>
<span><span class="co">#&gt;   ├─2 </span></span>
<span><span class="co">#&gt;   └─3</span></span></code></pre></div>
</div>
</div>
<div class="section level2" id="metaprogramação-capturando" number="7.8">
<h2>
<span class="header-section-number">7.8</span> Metaprogramação: Capturando<a aria-label="anchor" class="anchor" href="#metaprograma%C3%A7%C3%A3o-capturando"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="disclaimer" number="7.8.1">
<h3>
<span class="header-section-number">7.8.1</span> Disclaimer<a aria-label="anchor" class="anchor" href="#disclaimer"><i class="fas fa-link"></i></a>
</h3>
<p>Não é muito útil para a maioria dos problemas de ciência de dados. Mas é muito útil para criar pacotes, e para resolver problemas mais complexos.</p>
<p>Tema difícil, mas útil para fixar alguns conceitos de CC, e está muito bem mastigado.</p>
<blockquote>
<p>Few modern popular languages expose the level of metaprogramming that R provides.</p>
</blockquote>
<p>Não gastem seu cérebro de mais, mas não gastem de menos também.</p>
</div>
<div class="section level3" id="definição-3" number="7.8.2">
<h3>
<span class="header-section-number">7.8.2</span> Definição<a aria-label="anchor" class="anchor" href="#defini%C3%A7%C3%A3o-3"><i class="fas fa-link"></i></a>
</h3>
<p>Como dito, pode ser entendido como o estilo que coloca <em>expressões</em> no centro.</p>
<p>Existem três pilares:</p>
<ol style="list-style-type: decimal">
<li>Podemos capturar código como expressões (e amigos). Tanto de modo interativo, mas também passando-o para funções.</li>
<li>Podemos criar e alterar código programaticamente.</li>
<li>Podemos avaliar código em momentos oportunos, e escolhendo o ambiente de avaliação.</li>
</ol>
</div>
<div class="section level3" id="quoting" number="7.8.3">
<h3>
<span class="header-section-number">7.8.3</span> 1. Quoting<a aria-label="anchor" class="anchor" href="#quoting"><i class="fas fa-link"></i></a>
</h3>
<p>O ato de capturar/congelar código é chamado de <em>quoting</em>, uma vez que é similar à transformar código em uma string. Mas não é a mesma coisa.</p>
<p>Podemos congelar código com:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/expression.html">expression()</a></code>, que sempre retorna uma <em>expression</em>.</li>
<li>
<code><a href="https://rdrr.io/r/base/bquote.html">bquote()</a></code> e <code><a href="https://rlang.r-lib.org/reference/expr.html">rlang::expr()</a></code> retornam uma das “sub-expression”.</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#&gt; 10 + 1</span></span></code></pre></div>
</div>
<div class="section level3" id="parsing" number="7.8.4">
<h3>
<span class="header-section-number">7.8.4</span> 1. Parsing<a aria-label="anchor" class="anchor" href="#parsing"><i class="fas fa-link"></i></a>
</h3>
<p>Não é para você se encontrar nessa situação, mas se você tiver um código em uma string, você pode usar <code><a href="https://rdrr.io/r/base/parse.html">parse()</a></code> ou <code><a href="https://rlang.r-lib.org/reference/parse_expr.html">rlang::parse_expr()</a></code> para transformar em uma expressão.</p>
<p>O inverso de parsing é deparsing, conseguir uma string que geraria uma dada expressão. Use <code><a href="https://rdrr.io/r/base/deparse.html">deparse()</a></code> ou <code><a href="https://rlang.r-lib.org/reference/expr_label.html">rlang::expr_text()</a></code>.</p>
</div>
<div class="section level3" id="enriched-quoting" number="7.8.5">
<h3>
<span class="header-section-number">7.8.5</span> 1. Enriched Quoting<a aria-label="anchor" class="anchor" href="#enriched-quoting"><i class="fas fa-link"></i></a>
</h3>
<p>E se o código que quero congelar veio de um argumento de uma função?</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#&gt; ?</span></span></code></pre></div>
<p>Então, eu preciso de uma função mágica, que inspecione a promessa, e me retorne a expressão não avaliada. A função mágica é <code><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">enexpr()</a></code>.</p>
<blockquote>
<p>It’s called “en”-expr() by analogy to enrich. Enriching someone makes them richer; enexpr()ing a argument makes it an expression.</p>
</blockquote>
<p><code><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">exprs()</a></code> e <code><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">enexprs()</a></code> criam listas de expressões. Obs: diferente de um vetor do <em>tipo</em> expression.</p>
</div>
<div class="section level3" id="criando-symbols" number="7.8.6">
<h3>
<span class="header-section-number">7.8.6</span> 1. Criando Symbols<a aria-label="anchor" class="anchor" href="#criando-symbols"><i class="fas fa-link"></i></a>
</h3>
<p>Para ser mais restritivo, e exigir que um código esteja associado apenas a um símbolo, use <code><a href="https://rlang.r-lib.org/reference/sym.html">sym()</a></code>, <code><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">ensym()</a></code>, <code><a href="https://rlang.r-lib.org/reference/sym.html">syms()</a></code>, e <code><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">ensyms()</a></code>.</p>
</div>
<div class="section level3" id="criando-quosures" number="7.8.7">
<h3>
<span class="header-section-number">7.8.7</span> 1. Criando Quosures<a aria-label="anchor" class="anchor" href="#criando-quosures"><i class="fas fa-link"></i></a>
</h3>
<p>Já falamos que elas existem. Não falei por que elas são úteis, mas calma lá.</p>
<p>Ainda assim, como são criadas? Com a função <code><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">quo()</a></code>. E se eu quiser salvar a expressão e o ambiente de uma promessa, em uma quosure? Com <code><a href="https://rlang.r-lib.org/reference/enquo.html">enquo()</a></code>.</p>
</div>
</div>
<div class="section level2" id="metaprogramação-alterando" number="7.9">
<h2>
<span class="header-section-number">7.9</span> Metaprogramação: Alterando<a aria-label="anchor" class="anchor" href="#metaprograma%C3%A7%C3%A3o-alterando"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="criando-e-modificando-calls" number="7.9.1">
<h3>
<span class="header-section-number">7.9.1</span> 2. Criando e Modificando Calls<a aria-label="anchor" class="anchor" href="#criando-e-modificando-calls"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos criar calls com <code><a href="https://rdrr.io/r/base/call.html">call()</a></code> e <code><a href="https://rlang.r-lib.org/reference/call2.html">rlang::call2()</a></code>:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rlang.r-lib.org/reference/call2.html">call2</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; f(1, 2, 3)</span></span>
<span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/call2.html">call2</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rlang.r-lib.org/reference/call2.html">call2</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 + 2 * 3</span></span></code></pre></div>
<p>E se eu quiser alterar um componente específico de uma call? Com <code>[[</code> ou <code><a href="https://rlang.r-lib.org/reference/call_modify.html">rlang::call_modify()</a></code>:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/call2.html">call2</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">na.rm</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">x</span> <span class="co">#&gt; mean(c(1, 2, NA), na.rm = FALSE)</span></span>
<span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/call_modify.html">call_modify</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="co">#&gt; mean(c(1, 2, NA), na.rm = FALSE, trim = 0.1)</span></span></code></pre></div>
</div>
<div class="section level3" id="criando-e-modificando-expressions" number="7.9.2">
<h3>
<span class="header-section-number">7.9.2</span> 2. Criando e Modificando Expressions<a aria-label="anchor" class="anchor" href="#criando-e-modificando-expressions"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos seletivamente “unquote” e “quote” partes de código, usando o operador do rlang <code>!!</code>:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">xx</span> <span class="op">/</span> <span class="op">!</span><span class="op">!</span><span class="va">yy</span><span class="op">)</span> <span class="co">#&gt; (x + x)/(y + y)</span></span></code></pre></div>
<p>Temos também <code>!!!</code>:</p>
<blockquote>
<p><code>!!</code> is a one-to-one replacement. <code>!!!</code> (called “unquote-splice”, and pronounced bang-bang-bang) is a one-to-many replacement. It takes a list of expressions and inserts them at the location of the <code>!!!</code></p>
</blockquote>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">exprs</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; sum(x, x, x)</span></span></code></pre></div>
</div>
<div class="section level3" id="criando-e-modificando-functions" number="7.9.3">
<h3>
<span class="header-section-number">7.9.3</span> 2. Criando e Modificando Functions<a aria-label="anchor" class="anchor" href="#criando-e-modificando-functions"><i class="fas fa-link"></i></a>
</h3>
<p>Também podemos modificar os componentes de funções com <code><a href="https://rdrr.io/r/base/formals.html">formals()</a></code>, <code><a href="https://rdrr.io/r/base/body.html">body()</a></code>, <code><a href="https://rdrr.io/r/base/environment.html">environment()</a></code>. E podemos criar funções com <code><a href="https://rlang.r-lib.org/reference/new_function.html">rlang::new_function()</a></code>.</p>
</div>
</div>
<div class="section level2" id="metaprogramação-avaliando" number="7.10">
<h2>
<span class="header-section-number">7.10</span> Metaprogramação: Avaliando<a aria-label="anchor" class="anchor" href="#metaprograma%C3%A7%C3%A3o-avaliando"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3" id="avaliação" number="7.10.1">
<h3>
<span class="header-section-number">7.10.1</span> 3. Avaliação<a aria-label="anchor" class="anchor" href="#avalia%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos escolher quando e onde (em qual ambiente) avaliar uma expressão, via <code><a href="https://rdrr.io/r/base/eval.html">eval()</a></code>.</p>
<p>Especialmente, podemos:</p>
<ul>
<li>
<strong>Data mask:</strong> avaliar expressões no contexto de um dataframe – tratando as colunas como variáveis.</li>
<li>Alterar a definição de operadores temporariamente.</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/env.html">env</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; 11</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span>, envir <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="co">#&gt; 20.09062</span></span>
<span></span>
<span><span class="va">`+`</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html">expr</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/env.html">env</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">10</span>, `+` <span class="op">=</span> <span class="va">`+`</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; 110</span></span></code></pre></div>
<p>Podemos usar <code><a href="https://rlang.r-lib.org/reference/exec.html">rlang::exec()</a></code> para criar uma call igual à <code><a href="https://rlang.r-lib.org/reference/call2.html">call2()</a></code> e avaliá-la imediatamente.</p>
</div>
<div class="section level3" id="tidy-evaluation" number="7.10.2">
<h3>
<span class="header-section-number">7.10.2</span> 3. Tidy Evaluation<a aria-label="anchor" class="anchor" href="#tidy-evaluation"><i class="fas fa-link"></i></a>
</h3>
<p>Essas ferramentas de avaliação do rlang formam o tidy evaluation framework, que é a base do tidyverse. É uma maneira de avaliar código non-standard.</p>
<p>Por isso, não são todas as funções que a suportam. Use <code><a href="https://rlang.r-lib.org/reference/exec.html">exec()</a></code>, <code><a href="https://rlang.r-lib.org/reference/inject.html">inject()</a></code>, <code><a href="https://rlang.r-lib.org/reference/list2.html">list2()</a></code>, e <code><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy()</a></code> para trazer suporte a tidy evaluation.</p>
<p><code><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy()</a></code> está presente na maior parte das funções do tidyverse, e é dessa forma que pegamos uma expressão, avaliamos ela no contexto de um dataframe e seu ambiente pai também é definido.</p>
<p>Podemos usar <a href="https://adv-r.hadley.nz/evaluation.html#pronouns">pronomes</a> <code>.data$</code> e <code>.env$</code> para clarificar de qual dessas duas coisas queremos tirar as variáveis.</p>
</div>
<div class="section level3" id="outros-pontos" number="7.10.3">
<h3>
<span class="header-section-number">7.10.3</span> 3. Outros Pontos<a aria-label="anchor" class="anchor" href="#outros-pontos"><i class="fas fa-link"></i></a>
</h3>
<p>É muito comum usar <code>!!!</code> em conjunto com <code>...</code>, similar à <code>**</code> do python:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">dfs</span><span class="op">)</span></span></code></pre></div>
<p>E para fazer algo como o abaixo, precisamos de uma syntaxe especial para o R não brigar com a gente:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="paradigms.html#cb85-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">sym</span>(column1)</span>
<span id="cb85-2"><a href="paradigms.html#cb85-2" tabindex="-1"></a><span class="fu">tibble</span>(<span class="sc">!!</span><span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="co">#&gt; erro</span></span>
<span id="cb85-3"><a href="paradigms.html#cb85-3" tabindex="-1"></a><span class="fu">tibble</span>(<span class="sc">!!</span><span class="at">a :=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p>Para suportar ambos esses comportamentos, funções precisam colocar <code>...</code> em <code><a href="https://rlang.r-lib.org/reference/list2.html">list2()</a></code>, aí dizemos que suportam “tidy dots”.</p>
</div>
<div class="section level3" id="estudo-de-caso" number="7.10.4">
<h3>
<span class="header-section-number">7.10.4</span> Estudo de Caso<a aria-label="anchor" class="anchor" href="#estudo-de-caso"><i class="fas fa-link"></i></a>
</h3>
<p>Como usar isso para resolver problemas?</p>
<p>Vamos criar uma função a la <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>, como <code class="sourceCode r"><span class="fu">filter2</span>(mtcars, cyl <span class="sc">==</span> <span class="dv">4</span>)</code>.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filter2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">condition</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/enquo.html">enquo</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span>, <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">keep</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3" id="estudo-de-caso-1" number="7.10.5">
<h3>
<span class="header-section-number">7.10.5</span> Estudo de Caso<a aria-label="anchor" class="anchor" href="#estudo-de-caso-1"><i class="fas fa-link"></i></a>
</h3>
<p>Como usar isso para resolver problemas?</p>
<p>Vamos criar um wrapper de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code>, que pegue uma coluna e eleve ao quadrado.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mutate_squared</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">ensym</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">!</span><span class="op">!</span><span class="va">col</span> <span class="op">:=</span> <span class="op">!</span><span class="op">!</span><span class="va">col</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Acontece que esse é um padrão muito comum, e temos um atalho:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mutate_squared</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">{</span><span class="op">{</span><span class="va">col</span><span class="op">}</span><span class="op">}</span> <span class="op">:=</span> <span class="op">{</span><span class="op">{</span><span class="va">col</span><span class="op">}</span><span class="op">}</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr class="double-hrule"/>
</div>
</div>
<div class="section level2 unlisted unnumbered" id="complemento-5">
<h2>Complemento<a aria-label="anchor" class="anchor" href="#complemento-5"><i class="fas fa-link"></i></a>
</h2>
<div class="section level3 unnumbered" id="recapitulando-5">
<h3>Recapitulando<a aria-label="anchor" class="anchor" href="#recapitulando-5"><i class="fas fa-link"></i></a>
</h3>
<p>[a fazer]</p>
<hr class="single-hrule"/>
</div>
<div class="section level3 unnumbered" id="dicionário-de-funções-5">
<h3>Dicionário de Funções<a aria-label="anchor" class="anchor" href="#dicion%C3%A1rio-de-fun%C3%A7%C3%B5es-5"><i class="fas fa-link"></i></a>
</h3>
<p>[a fazer]</p>
<hr class="single-hrule"/>
</div>
<div class="section level3 unnumbered" id="referências-5">
<h3>Referências<a aria-label="anchor" class="anchor" href="#refer%C3%AAncias-5"><i class="fas fa-link"></i></a>
</h3>
<p>[a fazer]</p>
</div>
</div>
</div>
<div class="chapter-nav">
<div class="prev"><a href="funs-envs.html"><span class="header-section-number">6</span> Funções e Ambientes</a></div>
<div class="next"><a href="others1.html"><span class="header-section-number">8</span> Outros Tópicos</a></div>
</div></main><!-- Sub Nav --><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
<nav aria-label="On this page" data-toggle="toc" id="toc"><h2>Nesta página</h2>
<ul class="nav navbar-nav">
<li><a class="nav-link" href="#paradigms"><span class="header-section-number">7</span> Paradigmas de Programação</a></li>
<li><a class="nav-link" href="#introdu%C3%A7%C3%A3o-6"><span class="header-section-number">7.1</span> Introdução</a></li>
<li>
<a class="nav-link" href="#pf-fundamentos"><span class="header-section-number">7.2</span> PF: Fundamentos</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#programa%C3%A7%C3%A3o-funcional"><span class="header-section-number">7.2.1</span> Programação Funcional</a></li></ul>
</li>
<li>
<a class="nav-link" href="#pf-functionals"><span class="header-section-number">7.3</span> PF: Functionals</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#functionals"><span class="header-section-number">7.3.1</span> Functionals</a></li>
<li><a class="nav-link" href="#map-1"><span class="header-section-number">7.3.2</span> Map</a></li>
<li><a class="nav-link" href="#map-2"><span class="header-section-number">7.3.3</span> Map 2</a></li>
<li><a class="nav-link" href="#map2"><span class="header-section-number">7.3.4</span> Map^2</a></li>
<li><a class="nav-link" href="#map-p"><span class="header-section-number">7.3.5</span> Map p</a></li>
<li><a class="nav-link" href="#mapp"><span class="header-section-number">7.3.6</span> Map^p</a></li>
<li><a class="nav-link" href="#atalhos"><span class="header-section-number">7.3.7</span> Atalhos</a></li>
<li><a class="nav-link" href="#escolhendo-o-output"><span class="header-section-number">7.3.8</span> Escolhendo o Output</a></li>
<li><a class="nav-link" href="#e-amigos"><span class="header-section-number">7.3.9</span> E Amigos</a></li>
<li><a class="nav-link" href="#quando-usar-um-map"><span class="header-section-number">7.3.10</span> Quando Usar um Map?</a></li>
<li><a class="nav-link" href="#reduce"><span class="header-section-number">7.3.11</span> Reduce</a></li>
<li><a class="nav-link" href="#reduce-in%C3%ADcio-customizado"><span class="header-section-number">7.3.12</span> Reduce: Início Customizado</a></li>
<li><a class="nav-link" href="#reduce-2"><span class="header-section-number">7.3.13</span> Reduce 2</a></li>
<li><a class="nav-link" href="#reduce-outros"><span class="header-section-number">7.3.14</span> Reduce: Outros</a></li>
<li><a class="nav-link" href="#predicate-functionals"><span class="header-section-number">7.3.15</span> Predicate Functionals</a></li>
<li><a class="nav-link" href="#outros"><span class="header-section-number">7.3.16</span> Outros</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#pf-function-factories"><span class="header-section-number">7.4</span> PF: Function Factories</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#function-factories"><span class="header-section-number">7.4.1</span> Function Factories</a></li>
<li><a class="nav-link" href="#function-factories-envs"><span class="header-section-number">7.4.2</span> Function Factories’ Envs</a></li>
<li><a class="nav-link" href="#function-factories-envs-1"><span class="header-section-number">7.4.3</span> Function Factories’ Envs</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#pf-function-operators"><span class="header-section-number">7.5</span> PF: Function Operators</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#function-operators"><span class="header-section-number">7.5.1</span> Function Operators</a></li></ul>
</li>
<li>
<a class="nav-link" href="#oop"><span class="header-section-number">7.6</span> OOP</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#defini%C3%A7%C3%A3o-1"><span class="header-section-number">7.6.1</span> Definição</a></li>
<li><a class="nav-link" href="#sistemas-de-oop-no-r"><span class="header-section-number">7.6.2</span> Sistemas de OOP no R</a></li>
<li><a class="nav-link" href="#sistemas-de-oop-no-r-1"><span class="header-section-number">7.6.3</span> Sistemas de OOP no R</a></li>
<li><a class="nav-link" href="#quando-usar-oop"><span class="header-section-number">7.6.4</span> Quando Usar OOP</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#express%C3%B5es"><span class="header-section-number">7.7</span> Expressões</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#defini%C3%A7%C3%A3o-2"><span class="header-section-number">7.7.1</span> Definição</a></li>
<li><a class="nav-link" href="#tipos-de-express%C3%B5es"><span class="header-section-number">7.7.2</span> Tipos de Expressões</a></li>
<li><a class="nav-link" href="#tipos-baseados-em-express%C3%B5es"><span class="header-section-number">7.7.3</span> Tipos Baseados em Expressões</a></li>
<li><a class="nav-link" href="#ast"><span class="header-section-number">7.7.4</span> AST</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#metaprograma%C3%A7%C3%A3o-capturando"><span class="header-section-number">7.8</span> Metaprogramação: Capturando</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#disclaimer"><span class="header-section-number">7.8.1</span> Disclaimer</a></li>
<li><a class="nav-link" href="#defini%C3%A7%C3%A3o-3"><span class="header-section-number">7.8.2</span> Definição</a></li>
<li><a class="nav-link" href="#quoting"><span class="header-section-number">7.8.3</span> 1. Quoting</a></li>
<li><a class="nav-link" href="#parsing"><span class="header-section-number">7.8.4</span> 1. Parsing</a></li>
<li><a class="nav-link" href="#enriched-quoting"><span class="header-section-number">7.8.5</span> 1. Enriched Quoting</a></li>
<li><a class="nav-link" href="#criando-symbols"><span class="header-section-number">7.8.6</span> 1. Criando Symbols</a></li>
<li><a class="nav-link" href="#criando-quosures"><span class="header-section-number">7.8.7</span> 1. Criando Quosures</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#metaprograma%C3%A7%C3%A3o-alterando"><span class="header-section-number">7.9</span> Metaprogramação: Alterando</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#criando-e-modificando-calls"><span class="header-section-number">7.9.1</span> 2. Criando e Modificando Calls</a></li>
<li><a class="nav-link" href="#criando-e-modificando-expressions"><span class="header-section-number">7.9.2</span> 2. Criando e Modificando Expressions</a></li>
<li><a class="nav-link" href="#criando-e-modificando-functions"><span class="header-section-number">7.9.3</span> 2. Criando e Modificando Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#metaprograma%C3%A7%C3%A3o-avaliando"><span class="header-section-number">7.10</span> Metaprogramação: Avaliando</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#avalia%C3%A7%C3%A3o"><span class="header-section-number">7.10.1</span> 3. Avaliação</a></li>
<li><a class="nav-link" href="#tidy-evaluation"><span class="header-section-number">7.10.2</span> 3. Tidy Evaluation</a></li>
<li><a class="nav-link" href="#outros-pontos"><span class="header-section-number">7.10.3</span> 3. Outros Pontos</a></li>
<li><a class="nav-link" href="#estudo-de-caso"><span class="header-section-number">7.10.4</span> Estudo de Caso</a></li>
<li><a class="nav-link" href="#estudo-de-caso-1"><span class="header-section-number">7.10.5</span> Estudo de Caso</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#complemento-5">Complemento</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#recapitulando-5">Recapitulando</a></li>
<li><a class="nav-link" href="#dicion%C3%A1rio-de-fun%C3%A7%C3%B5es-5">Dicionário de Funções</a></li>
<li><a class="nav-link" href="#refer%C3%AAncias-5">Referências</a></li>
</ul>
</li>
</ul>
<!--<div class="book-extra">
            <ul class="list-unstyled">
              <li><a id="book-source" href="#">Ver código <i class="fab fa-github"></i></a></li>
              <li><a id="book-edit" href="#" style="display: none">Edite o código <i class="fab fa-github"></i></a></li>
            </ul>
          </div>-->
</nav>
</div>
</div>
</div></main> <!-- .container -->
<footer id="rssite-footer"><p>
            Livro feito com <a href="https://bookdown.org">bookdown</a><span class="footer-div"></span>
            tema <a href="https://github.com/ricardo-semiao/ricardo-semiao/tree/main/themes/rsbookdown">rsbookdown</a>.
        </p>
</footer><button aria-hidden="true" id="back-to-top" onclick="window.scrollTo(0, 0); return false;">
<span>↑</span> Back to top
    </button><script src="/assets/global.js"></script>
<!-- Scripts -->
<script src="./assets/rsbd_module.js"></script><!-- dynamically load mathjax for compatibility with self-contained --><script>
        (function () {
        var script = document.createElement("script");
        script.type = "text/javascript";
        var src = "true";
        if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
        if (location.protocol !== "file:")
            if (/^https?:/.test(src))
            src = src.replace(/^https?:/, '');
        script.src = src;
        document.getElementsByTagName("head")[0].appendChild(script);
        })();
    </script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
    for (let popover of popovers) {
        const div = document.createElement('div');
        div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
        div.innerHTML = popover.getAttribute('data-content');
    
        var has_math = div.querySelector("span.math");
        if (has_math) {
        document.body.appendChild(div);
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
        MathJax.Hub.Queue(function() {
            popover.setAttribute('data-content', div.innerHTML);
            document.body.removeChild(div);
        })
        }
    }
    </script>
</body>
</html>
